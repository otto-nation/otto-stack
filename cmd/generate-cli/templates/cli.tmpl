// Code generated by cmd/generate-cli. DO NOT EDIT.

package cli

import (
	"fmt"

	"github.com/otto-nation/otto-stack/internal/pkg/base"
	"github.com/otto-nation/otto-stack/internal/pkg/cli/handlers"
	"github.com/otto-nation/otto-stack/internal/core"
	"github.com/spf13/cobra"
)

// addPersistentFlags adds persistent global flags to root command
func addPersistentFlags(cmd *cobra.Command) {
{{range $name, $flag := .global.flags.persistent}}	cmd.PersistentFlags().{{if eq $flag.type "bool"}}Bool{{else if eq $flag.type "int"}}Int{{else}}String{{end}}("{{$name}}", {{if eq $flag.type "bool"}}{{$flag.default}}{{else if eq $flag.type "int"}}{{$flag.default}}{{else}}{{if $flag.default}}"{{$flag.default}}"{{else}}""{{end}}{{end}}, "{{$flag.description}}")
{{if $flag.short}}	cmd.PersistentFlags().Lookup("{{$name}}").Shorthand = "{{$flag.short}}"
{{end}}{{end}}}

// addConditionalFlags adds conditional global flags based on command category
func addConditionalFlags(cmd *cobra.Command, category string) {
{{range $name, $flag := .global.flags.conditional}}	// {{$name}} flag for categories: {{$flag.categories}}
	{{toPascalCase $name}}Categories := []string{ {{range $flag.categories}}"{{.}}", {{end}} }
	for _, cat := range {{toPascalCase $name}}Categories {
		if cat == category {
			cmd.Flags().{{if eq $flag.type "bool"}}Bool{{else if eq $flag.type "int"}}Int{{else}}String{{end}}("{{$name}}", {{if eq $flag.type "bool"}}{{$flag.default}}{{else if eq $flag.type "int"}}{{$flag.default}}{{else}}{{if $flag.default}}"{{$flag.default}}"{{else}}""{{end}}{{end}}, "{{$flag.description}}")
			break
		}
	}
{{end}}}

// BuildRootCommand creates the root command with all subcommands
func BuildRootCommand() *cobra.Command {
	rootCmd := &cobra.Command{
		Use:   "otto-stack",
		Short: "Otto Stack CLI",
		Long:  "A powerful development stack management tool",
	}

	// Add persistent global flags to root command
	addPersistentFlags(rootCmd)

{{range $name, $cmd := .commands}}
	// {{$name}} command
	{{toPascalCase $name}}Cmd := &cobra.Command{
		Use:   "{{$name}}",
		Short: "{{$cmd.description}}",
		Long:  `{{$cmd.long_description}}`,
		RunE: func(cmd *cobra.Command, args []string) error {
			handler := handlers.Get("{{$cmd.handler}}", core.Command{{toPascalCase $name}})
			if handler == nil {
				return fmt.Errorf("handler not found for command: {{$name}}")
			}
			baseCmd := base.NewBaseCommand(cmd)
			return handler.Handle(cmd.Context(), cmd, args, baseCmd)
		},
	}

	// Add conditional global flags based on command category
	addConditionalFlags({{toPascalCase $name}}Cmd, "{{getCommandCategory $name}}")

{{if $cmd.flags}}	// Command-specific flags
{{range $flagName, $flag := $cmd.flags}}	{{toPascalCase $name}}Cmd.Flags().{{if eq $flag.type "bool"}}Bool{{else if eq $flag.type "int"}}Int{{else if eq $flag.type "stringArray"}}StringArray{{else}}String{{end}}("{{$flagName}}", {{if eq $flag.type "bool"}}{{$flag.default}}{{else if eq $flag.type "int"}}{{$flag.default}}{{else}}{{if $flag.default}}"{{$flag.default}}"{{else}}""{{end}}{{end}}, "{{$flag.description}}")
{{end}}{{end}}
	rootCmd.AddCommand({{toPascalCase $name}}Cmd)

{{end}}
	return rootCmd
}