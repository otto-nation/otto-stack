###############################################################
#  otto-stack: Commands Configuration                          #
#-------------------------------------------------------------#
#  Single source of truth for otto-stack CLI commands,         #
#  flags, examples, and documentation.                        #
#                                                             #
#  This file is used to:                                      #
#  - Generate CLI command structures automatically            #
#  - Create comprehensive documentation                       #
#  - Validate CLI implementation consistency                  #
#  - Enable rich help text and shell completion               #
#  - Provide command discovery and suggestions                #
###############################################################

validation:
  docker:
    name: "Docker availability"
    description: "Validate Docker installation and daemon status"
    commands: ["up", "down", "validate", "doctor"]
    required: true
  config-syntax:
    name: "Configuration syntax"
    description: "Validate YAML/JSON configuration syntax"
    commands: ["validate", "init"]
    required: true
  service-definitions:
    name: "Service definitions"
    description: "Validate service definitions and dependencies"
    commands: ["up", "validate"]
    required: true
  file-permissions:
    name: "File permissions"
    description: "Check file and directory permissions"
    commands: ["init", "validate"]
    required: false

global:
  flags:
    # Always inherited by ALL commands
    persistent:
      verbose:
        type: "bool"
        description: "Enable verbose output"
        default: false
      help:
        short: "h"
        type: "bool"
        description: "Show help information"
        default: false
      version:
        type: "bool"
        description: "Show version information"
        default: false
      quiet:
        type: "bool"
        description: "Suppress non-essential output (CI-friendly)"
        default: false

    # Applied selectively based on command categories
    conditional:
      json:
        type: "bool"
        description: "Output in JSON format (CI-friendly)"
        default: false
        categories: ["development", "management"]
      no-color:
        type: "bool"
        description: "Disable colored output (CI-friendly)"
        default: false
        categories: ["development", "management", "lifecycle"]
      non-interactive:
        type: "bool"
        description: "Run in non-interactive mode (CI-friendly)"
        default: false
        categories: ["project", "lifecycle"]
      dry-run:
        type: "bool"
        description: "Show what would be done without executing"
        default: false
        categories: ["lifecycle", "management"]

categories:
  project:
    name: "Project Management"
    description: "Initialize, validate, and manage project setup"
    icon: "üìÅ"
    commands: ["init", "validate", "services", "deps", "conflicts", "doctor"]

  lifecycle:
    name: "Service Lifecycle"
    description: "Start, stop, and manage running services"
    icon: "üöÄ"
    commands: ["up", "down", "restart", "cleanup"]

  operations:
    name: "Operations & Data"
    description: "Monitor, connect to, and manage service data"
    icon: "‚öôÔ∏è"
    commands: ["status", "logs", "exec", "connect"]

  utility:
    name: "Utility"
    description: "Information and development tools"
    icon: "üõ†Ô∏è"
    commands: ["version", "help", "web-interfaces"]

commands:
  up:
    description: "Start development stack services"
    long_description: |
      Start one or more services in the development stack. The command is context-aware:
      - **In a project directory**: Starts project services (including shared containers)
      - **Outside a project**: Starts only shared containers (requires service names)

      When sharing is enabled, containers are registered in ~/.otto-stack/shared/containers.yaml
      to track which projects use them.
    usage: "up [service...]"
    aliases: ["start", "run"]
    examples:
      - command: "otto-stack up"
        description: "Start all configured services (in project context)"
      - command: "otto-stack up postgres redis"
        description: "Start specific services"
      - command: "cd ~ && otto-stack up redis"
        description: "Start shared containers from global context"
      - command: "otto-stack up --detach --build"
        description: "Build images and start services in background"
    flags:
      detach:
        type: "bool"
        description: "Run services in background (detached mode)"
        default: false
      build:
        type: "bool"
        description: "Build images before starting services"
        default: false
      force-recreate:
        type: "bool"
        description: "Recreate containers even if config hasn't changed"
        default: false
      no-deps:
        type: "bool"
        description: "Don't start linked services"
        default: false
      timeout:
        type: "string"
        description: "Timeout for service startup (e.g., 30s, 2m)"
        default: "30s"
      resolve-deps:
        type: "bool"
        description: "Show dependency resolution tree before starting"
        default: false
      skip-conflicts:
        type: "bool"
        description: "Skip conflict detection (faster startup)"
        default: false
    related_commands: ["down", "restart", "status"]
    tips:
      - "Add --build if you've made changes to Dockerfiles"
      - "Use --detach to free up your terminal while services run"
      - "Shared containers persist across projects when sharing is enabled"

  down:
    description: "Stop development stack services"
    long_description: |
      Stop one or more services in the development stack. The command is context-aware:
      - **In a project directory**: Stops project services, prompts before stopping shared containers
      - **Outside a project**: Stops shared containers (requires service names)

      When stopping shared containers, you'll be prompted if they're used by other projects.
      The registry at ~/.otto-stack/shared/containers.yaml is updated to remove the project.
    usage: "down [service...]"
    aliases: ["stop"]
    examples:
      - command: "otto-stack down"
        description: "Stop all running services (prompts for shared containers)"
      - command: "otto-stack down postgres redis"
        description: "Stop specific services"
      - command: "otto-stack down --volumes"
        description: "Stop services and remove volumes"
      - command: "otto-stack down --timeout 5"
        description: "Stop services with custom timeout"
    flags:
      remove:
        type: "bool"
        description: "Remove containers (default: false, just stops them)"
        default: false
      volumes:
        type: "bool"
        description: "Remove named volumes and anonymous volumes"
        default: false
      remove-orphans:
        type: "bool"
        description: "Remove containers for services not in compose file"
        default: false
      timeout:
        type: "int"
        description: "Shutdown timeout in seconds"
        default: 10
      remove-images:
        type: "string"
        description: "Remove images (all|local)"
        default: ""
        options: ["all", "local"]
    related_commands: ["up", "cleanup", "status"]
    tips:
      - "Use --volumes carefully as it will delete all data"
      - "Shared containers prompt before stopping if used by other projects"
      - "Add --remove-orphans to clean up unused containers"

  restart:
    description: "Restart development stack services"
    long_description: |
      Restart one or more services. This is equivalent to running down followed
      by up, but more efficient for quick restarts.
    usage: "restart [service...]"
    examples:
      - command: "otto-stack restart"
        description: "Restart all services"
      - command: "otto-stack restart postgres"
        description: "Restart a specific service"
      - command: "otto-stack restart --timeout 5"
        description: "Restart with custom timeout"
    flags:
      timeout:
        type: "int"
        description: "Restart timeout in seconds"
        default: 10
      no-deps:
        type: "bool"
        description: "Don't restart linked services"
        default: false
    related_commands: ["up", "down", "status"]

  status:
    description: "Show status of development stack services"
    long_description: |
      Display comprehensive status information for services. The command is context-aware:
      - **In a project directory**: Shows project services status
      - **Outside a project**: Use --all flag to see all projects' shared containers
    usage: "status [service...]"
    aliases: ["ps", "ls"]
    examples:
      - command: "otto-stack status"
        description: "Show status of all services (in project context)"
      - command: "otto-stack status postgres redis"
        description: "Show status of specific services"
      - command: "cd ~ && otto-stack status --all"
        description: "Show all projects' shared containers (global context)"
      - command: "otto-stack status --format json"
        description: "Output status in JSON format"
      - command: "otto-stack status --watch"
        description: "Watch for status changes in real-time"
      - command: "otto-stack status --filter running"
        description: "Show only running services"
    flags:
      format:
        type: "string"
        description: "Output format (table|json|yaml)"
        default: "table"
        options: ["table", "json", "yaml"]
      watch:
        type: "bool"
        description: "Watch for status changes"
        default: false
      quiet:
        type: "bool"
        description: "Only show service names and basic status"
        default: false
      filter:
        type: "string"
        description: "Filter services by status"
        options: ["running", "stopped", "starting", "unhealthy"]
      no-trunc:
        type: "bool"
        description: "Don't truncate output"
        default: false
      all:
        type: "bool"
        description: "Show status across all projects (including shared containers)"
        default: false
    related_commands: ["logs", "status"]
    tips:
      - "Use --watch to monitor services in real-time"
      - "Try --format json for programmatic access"
      - "Use --filter to focus on specific service states"
      - "Use --all to see shared containers across all projects"

  logs:
    description: "View logs from services"
    long_description: |
      View and follow logs from one or more services. Supports filtering,
      timestamps, and real-time following. Logs from multiple services are
      color-coded for easy identification.
    usage: "logs [service...]"
    examples:
      - command: "otto-stack logs"
        description: "Show logs from all services"
      - command: "otto-stack logs postgres redis"
        description: "Show logs from specific services"
      - command: "otto-stack logs --follow postgres"
        description: "Follow logs from postgres in real-time"
      - command: "otto-stack logs --tail 100 --since 1h"
        description: "Show last 100 lines from the past hour"
    flags:
      follow:
        type: "bool"
        description: "Follow log output in real-time"
        default: false
      tail:
        type: "string"
        description: "Number of lines to show from end of logs"
        default: "all"
      since:
        type: "string"
        description: "Show logs since timestamp or relative time"
        default: ""
      timestamps:
        type: "bool"
        description: "Show timestamps in log output"
        default: false
      no-color:
        type: "bool"
        description: "Disable colored output"
        default: false
      no-prefix:
        type: "bool"
        description: "Don't show service name prefix"
        default: false
    related_commands: ["status"]
    tips:
      - "Use --follow to see logs in real-time"
      - "Combine --tail and --since for targeted log viewing"
      - "Use --timestamps to correlate events across services"

  doctor:
    description: "Diagnose and troubleshoot stack health"
    long_description: |
      Run comprehensive health checks on your development stack. Identifies
      common issues, provides troubleshooting suggestions, and validates
      service configurations.
    usage: "doctor [service...]"
    examples:
      - command: "otto-stack doctor"
        description: "Run health checks on all services"
      - command: "otto-stack doctor postgres"
        description: "Diagnose a specific service"
      - command: "otto-stack doctor --fix"
        description: "Attempt to fix detected issues"
    flags:
      fix:
        type: "bool"
        description: "Attempt to automatically fix issues"
        default: false
      format:
        type: "string"
        description: "Output format (table|json)"
        default: "table"
        options: ["table", "json"]
    related_commands: ["status", "logs"]
    tips:
      - "Run doctor when services aren't behaving as expected"
      - "Use --fix to attempt automatic resolution of common issues"

  exec:
    description: "Execute commands in running service containers"
    long_description: |
      Execute commands inside running service containers. Useful for database
      operations, debugging, and maintenance tasks. Supports interactive and
      non-interactive modes.
    usage: "exec <service> <command> [args...]"
    examples:
      - command: "otto-stack exec postgres psql -U postgres"
        description: "Connect to PostgreSQL with psql"
      - command: "otto-stack exec redis redis-cli"
        description: "Connect to Redis CLI"
      - command: "otto-stack exec postgres bash"
        description: "Open bash shell in postgres container"
    flags:
      user:
        short: "u"
        type: "string"
        description: "Username to execute command as"
        default: ""
      workdir:
        type: "string"
        description: "Working directory for command"
        default: ""
      interactive:
        short: "i"
        type: "bool"
        description: "Keep STDIN open (interactive mode)"
        default: true
      tty:
        type: "bool"
        description: "Allocate a pseudo-TTY"
        default: true
      detach:
        type: "bool"
        description: "Run command in background"
        default: false
      env:
        type: "string"
        description: "Set environment variables (comma-separated key=value pairs)"
        default: ""
    related_commands: ["connect", "logs"]
    tips:
      - "Use for database maintenance and debugging"
      - "Combine with --user to run as specific user"

  connect:
    description: "Quick connect to service databases and interfaces"
    long_description: |
      Quickly connect to service databases and management interfaces using
      appropriate client tools. Automatically configures connection parameters
      based on service configuration.
    usage: "connect <service>"
    examples:
      - command: "otto-stack connect postgres"
        description: "Connect to PostgreSQL database"
      - command: "otto-stack connect redis"
        description: "Connect to Redis CLI"
      - command: "otto-stack connect mysql"
        description: "Connect to MySQL database"
    flags:
      database:
        type: "string"
        description: "Database name to connect to"
        default: ""
      user:
        short: "u"
        type: "string"
        description: "Username for connection"
        default: ""
      host:
        short: "h"
        type: "string"
        description: "Host to connect to"
        default: "localhost"
      port:
        short: "p"
        type: "int"
        description: "Port to connect to"
        default: 0
      read-only:
        type: "bool"
        description: "Connect in read-only mode"
        default: false
    related_commands: ["exec", "status"]
    tips:
      - "Automatically uses correct client tools for each service"
      - "Use --read-only for safe data exploration"

  cleanup:
    description: "Clean up unused resources and data"
    long_description: |
      Clean up unused Docker resources, temporary files, and orphaned data
      created by otto-stack services. Helps reclaim disk space and maintain
      a clean development environment.
    usage: "cleanup [options]"
    examples:
      - command: "otto-stack cleanup"
        description: "Interactive cleanup with confirmations"
      - command: "otto-stack cleanup --all --force"
        description: "Clean up everything without prompts"
      - command: "otto-stack cleanup --dry-run"
        description: "Preview what would be cleaned up"
    flags:
      all:
        short: "a"
        type: "bool"
        description: "Clean up all resources (containers, volumes, images)"
        default: false
      volumes:
        type: "bool"
        description: "Remove unused volumes"
        default: false
      images:
        type: "bool"
        description: "Remove unused images"
        default: false
      networks:
        type: "bool"
        description: "Remove unused networks"
        default: false
      force:
        short: "f"
        type: "bool"
        description: "Don't prompt for confirmation"
        default: false
      orphans:
        type: "bool"
        description: "Clean up orphaned shared containers (containers with no projects)"
        default: false
      project:
        short: "p"
        type: "string"
        description: "Clean specific project (if not specified, cleans current project)"
        default: ""
    related_commands: ["down", "doctor"]
    tips:
      - "Use --dry-run first to see what will be removed"
      - "Be careful with --volumes as it removes all data"

  init:
    description: "Initialize a new otto-stack project interactively"
    long_description: |
      Initialize a new otto-stack project in the current directory with an
      interactive setup process. Guides you through selecting services,
      configuring validation and advanced settings, and creates all
      necessary configuration files.
    usage: "init [flags]"
    examples:
      - command: "otto-stack init"
        description: "Interactive project initialization (recommended)"
      - command: "otto-stack init --project-name myproject --services postgres,redis"
        description: "Non-interactive setup with specific project name and services"
      - command: "otto-stack init --force"
        description: "Overwrite existing configuration"
    flags:
      force:
        short: "f"
        type: "bool"
        description: "Overwrite existing files"
        default: false
      project-name:
        type: "string"
        description: "Project name (defaults to current directory name)"
        default: ""
      services:
        type: "string"
        description: "Comma-separated list of services to include (required for non-interactive mode)"
        default: ""
      no-shared-containers:
        type: "bool"
        description: "Disable shared containers for all services"
        default: false
      shared-services:
        type: "string"
        description: "Comma-separated list of services to share across projects (e.g., postgres,redis). Overrides global sharing setting for specified services."
        default: ""
    related_commands: ["validate"]

  web-interfaces:
    description: "Show web interfaces for running services"
    long_description: |
      Display web interfaces (dashboards, UIs) for running services.
      Shows URLs and availability status for easy access to service
      management interfaces.
    usage: "web-interfaces [service-name] [flags]"
    examples:
      - command: "otto-stack web-interfaces"
        description: "Show all web interfaces for running services"
      - command: "otto-stack web-interfaces localstack"
        description: "Show interfaces for specific service"
      - command: "otto-stack web-interfaces --all"
        description: "Show interfaces for all enabled services"
    flags:
      all:
        type: "bool"
        description: "Show interfaces for all enabled services, even if not running"
        default: false
    related_commands: ["status", "up"]

  services:
    description: "List available services by category"
    long_description: |
      List all available services organized by category (database, cache,
      messaging, observability, cloud). Shows service descriptions and
      dependencies for easy discovery and selection.
    usage: "services [flags]"
    examples:
      - command: "otto-stack services"
        description: "List all services grouped by category"
      - command: "otto-stack services --category database"
        description: "List services in database category"
      - command: "otto-stack services --category cache"
        description: "List cache services"
      - command: "otto-stack services --format table"
        description: "List services in table format"
    flags:
      category:
        type: "string"
        description: "Show services in specific category"
        default: ""
        options: ["database", "cache", "messaging", "observability", "cloud"]
      format:
        type: "string"
        description: "Output format (group|table|json|yaml)"
        default: "group"
        options: ["group", "table", "json", "yaml"]
    related_commands: ["deps", "conflicts", "init"]

  deps:
    description: "Show dependency tree for a service"
    long_description: |
      Display the complete dependency tree for a service, showing all required
      dependencies and the resolved start order. Helps understand service
      relationships and startup sequences.
    usage: "deps <service>"
    examples:
      - command: "otto-stack deps kafka-ui"
        description: "Show dependencies for kafka-ui service"
      - command: "otto-stack deps postgres"
        description: "Show dependencies for postgres service"
    related_commands: ["services", "conflicts", "up"]

  conflicts:
    description: "Check for conflicts between services"
    long_description: |
      Check if the specified services have any conflicts that would prevent
      them from running together. Identifies port conflicts, resource conflicts,
      and incompatible service combinations.
    usage: "conflicts <service1> <service2> [service...]"
    examples:
      - command: "otto-stack conflicts postgres mysql"
        description: "Check if postgres and mysql conflict"
      - command: "otto-stack conflicts postgres redis kafka-broker"
        description: "Check conflicts between multiple services"
    related_commands: ["services", "deps", "up"]

  validate:
    description: "Validate configurations and manifests"
    long_description: |
      Validate otto-stack configurations, service definitions, and YAML
      manifests. Checks for syntax errors, missing dependencies, and
      configuration inconsistencies.
    usage: "validate [file...]"
    examples:
      - command: "otto-stack validate"
        description: "Validate all configuration files"
      - command: "otto-stack validate otto-stack-config.yaml"
        description: "Validate specific configuration file"
      - command: "otto-stack validate --strict"
        description: "Use strict validation rules"
    flags:
      strict:
        type: "bool"
        description: "Use strict validation rules"
        default: false
      format:
        type: "string"
        description: "Output format (table|json)"
        default: "table"
        options: ["table", "json"]
      fix:
        type: "bool"
        description: "Attempt to fix validation errors"
        default: false
    related_commands: ["doctor"]

  version:
    description: "Show version information"
    long_description: |
      Display version information for otto-stack including build details,
      Git commit, and platform information. Can check for available updates.
    usage: "version"
    flags:
      full:
        type: "bool"
        description: "Show detailed version information"
        default: false
      check-updates:
        type: "bool"
        description: "Check for available updates"
        default: false
      format:
        type: "string"
        description: "Output format (text, json, yaml)"
        default: "text"
    examples:
      - command: "otto-stack version"
        description: "Show basic version information"
      - command: "otto-stack version --full"
        description: "Show detailed build information"
      - command: "otto-stack version --check-updates"
        description: "Check for available updates"

# Help and documentation sections
help:
  getting_started: |
    ## Getting Started with otto-stack

    1. Initialize a new project:
       otto-stack init

    2. Start your development services:
       otto-stack up

    3. Check service status:
       otto-stack status

    4. View logs:
       otto-stack logs --follow

    For more help, visit: https://otto-stack.dev/docs

  common_tasks: |
    ## Common Tasks

    **Start services for web development:**
    otto-stack up postgres redis

    **Connect to database:**
    otto-stack connect postgres

    **View real-time logs:**
    otto-stack logs --follow

    **Clean up resources:**
    otto-stack cleanup --dry-run

  troubleshooting: |
    ## Troubleshooting

    **Services won't start:**
    - Run: otto-stack doctor
    - Check: otto-stack logs <service>

    **Port conflicts:**
    - Use: otto-stack status
    - Modify port mappings in config

    **Out of disk space:**
    - Run: otto-stack cleanup --dry-run
    - Then: otto-stack cleanup --all

    **Performance issues:**
    - Check: otto-stack status
    - Review logs: otto-stack logs --follow

# Centralized icons for consistent display
icons:
  state:
    running: "üü¢"
    stopped: "üî¥"
    created: "üü°"
    starting: "üü°"
    paused: "‚è∏Ô∏è"
    default: "‚ö™"
  health:
    healthy: "‚úÖ"
    unhealthy: "‚ùå"
    starting: "üü°"
    none: "‚ùì"
    default: "‚ùì"
  category:
    lifecycle: "üöÄ"
    monitoring: "üìä"
    data: "üíæ"
    maintenance: "üßπ"
    development: "üõ†Ô∏è"
    utility: "‚ÑπÔ∏è"
    web: "üåê"
    default: "üì¶"
