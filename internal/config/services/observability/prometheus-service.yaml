name: prometheus-service
description: Prometheus metrics collection and monitoring system
service_type: container
shareable: true

environment:
  PROMETHEUS_HOST: ${PROMETHEUS_HOST:-localhost}
  PROMETHEUS_PORT: ${PROMETHEUS_PORT:-9090}
  PROMETHEUS_URL: http://${PROMETHEUS_HOST:-localhost}:${PROMETHEUS_PORT:-9090}

container:
  image: prom/prometheus:latest
  ports:
    - external: "9090"
      internal: "9090"
      protocol: tcp
  restart: unless-stopped
  memory_limit: 256m
  command:
    - --config.file=/etc/prometheus/prometheus.yml
    - --storage.tsdb.path=/prometheus
    - --web.console.libraries=/etc/prometheus/console_libraries
    - --web.console.templates=/etc/prometheus/consoles
    - --storage.tsdb.retention.time=15d
    - --web.enable-lifecycle
    - --web.enable-admin-api
  health_check:
    test:
      [
        "CMD",
        "wget",
        "--no-verbose",
        "--tries=1",
        "--spider",
        "http://localhost:9090/-/healthy",
      ]
    interval: 30s
    timeout: 10s
    retries: 3

service:
  connection:
    type: web
    default_port: 9090
    url_pattern: "http://localhost:9090"
  dependencies:
    provides:
      - metrics
      - monitoring

configuration_schema:
  type: object
  properties:
    scrape_configs:
      type: array
      description: Prometheus scrape configurations
      items:
        type: object
        properties:
          job_name:
            type: string
            description: Job name
          static_configs:
            type: array
            description: Static target configurations
          scrape_interval:
            type: string
            default: "15s"
            description: Scrape interval
        required: ["job_name"]

documentation:
  usage_notes: Metrics collection and monitoring. Scrapes application /metrics endpoints.
  links:
    - https://prometheus.io/docs/
  use_cases:
    - Application metrics collection
    - Performance monitoring
    - Alerting and notifications
  web_interfaces:
    - name: Prometheus UI
      url: http://localhost:9090
      description: Prometheus web interface for querying metrics
